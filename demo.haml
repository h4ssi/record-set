!!! 5
%html
  %head
    %title "record-set demo"
    %script(src="../platform/platform.js")
    %link(rel="import" href="../polymer/polymer.html")
    %link(rel="import" href="record-set.html")
  %body
    %polymer-element(name="my-record" extends="record-base" type="test" attributes="label" noscript)
    %polymer-element(name="my-record-view" extends="my-record")
      %template
        %li 
          {{type}}: {{rid}} -> {{label}}
          %template(if="{{noautoload != undefined}}")
            %a(href="#" id="reload") Reload
          %a(href="#" id="delete") Delete
      :coffeescript
        Polymer 'my-record-view',
          ready: () ->
            @load()
            if @$.reload?
              @$.reload.addEventListener "click", (e) =>
                e.preventDefault()
                e.returnValue = false
                @load()
            @$.delete.addEventListener "click", (e) =>
              e.preventDefault()
              e.returnValue = false
              @delete()
    %polymer-element(name="demo-app")
      %template
        %record-set(id="data")

        %my-record(id="x" persist rid="1" label="test")
        %my-record(id="y" persist rid="2" label="test2")
        
        %p
          set label to
          %input(id="labelField" type="text")
          %a(href="#" id="labelFieldClick") Change
        
        %h3 autoloading
        %ul
          %template(repeat="{{$.x.all}}")
            %my-record-view(rid="{{}}")

        %h3 noautoloading
        %ul
          %template(repeat="{{$.y.all}}")
            %my-record-view(rid="{{}}" noautoload)

      :coffeescript
        Polymer 'demo-app',
          ready: () -> 
            @$.labelFieldClick.addEventListener "click", (e) =>
              e.preventDefault()
              e.returnValue = false
              @$.x.label = @$.labelField.value
              @$.x.save()
            console.log "ready"
    %demo-app
