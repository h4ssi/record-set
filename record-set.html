<!DOCTYPE html>
<link href='../polymer/polymer.html' rel='import'>
<polymer-element attributes='records' name='record-set'>
  <template></template>
  <script>
    (function() {
      var data;
    
      data = {};
    
      Polymer({
        _data: void 0,
        computed: {
          all: '_extractRecords(_data)'
        },
        ready: function() {
          return this._data = data;
        },
        save: function(type, record) {
          var k, r, v, _ref, _results;
          if (this._data[type] == null) {
            this._data[type] = {
              records: {},
              next: 1
            };
          }
          r = this._data[type].records[record.rid];
          if (r == null) {
            r = {};
          }
          if (r.rid == null) {
            r.rid = this._data[type].next++;
          }
          this._data[type].records[r.rid] = r;
          _ref = record.publish;
          _results = [];
          for (k in _ref) {
            v = _ref[k];
            if (!(k === "rid" || k === "persist" || k === "type")) {
              _results.push(r[k] = record[k]);
            } else {
              _results.push(void 0);
            }
          }
          return _results;
        },
        load: function(type, record) {
          var k, v, _ref, _results;
          if ((this._data[type] != null) && (this._data[type].records[record.rid] != null)) {
            _ref = this._data[type].records[record.rid];
            _results = [];
            for (k in _ref) {
              v = _ref[k];
              if (k !== "rid") {
                _results.push(record[k] = v);
              } else {
                _results.push(void 0);
              }
            }
            return _results;
          }
        },
        _extractRecords: function(data) {
          return new function() {
            var id, record, type, value;
            for (type in data) {
              value = data[type];
              this[type] = (function() {
                var _ref, _results;
                _ref = value.records;
                _results = [];
                for (id in _ref) {
                  record = _ref[id];
                  _results.push(record.rid);
                }
                return _results;
              })();
            }
            return this;
          };
        }
      });
    
    }).call(this);
  </script>
</polymer-element>
<polymer-element attributes='rid persist type' name='record-base'>
  <template>
    <record-set id='set'></record-set>
  </template>
  <script>
    (function() {
      Polymer({
        rid: void 0,
        observe: {
          '$.set.data': 'load'
        },
        computed: {
          all: '$.set.all[type]'
        },
        ready: function() {
          if (this.persist != null) {
            this.save();
          }
          if (this.rid != null) {
            return this.load();
          }
        },
        save: function() {
          return this.$.set.save(this.type, this);
        },
        load: function() {
          return this.$.set.load(this.type, this);
        },
        _lc: function(s) {
          return s.toLowerCase();
        }
      });
    
    }).call(this);
  </script>
</polymer-element>
